<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GF Motor å¾Œå°ç®¡ç†ç³»çµ±</title>
    <style>
        /* é é¢åŸºç¤æ¨£å¼ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #2c3e50; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .login-container { background: white; padding: 2.5rem; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 400px; text-align: center; }
        
        h2 { color: #34495e; margin-bottom: 20px; border-bottom: 3px solid #e74c3c; display: inline-block; padding-bottom: 5px; }
        
        /* è¼¸å…¥æ¡†é€šç”¨æ¨£å¼ */
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; color: #666; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; transition: 0.3s; box-sizing: border-box; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        button { width: 100%; padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; transition: background 0.3s; }
        button:hover { background: #c0392b; }
        
        /* éŒ¯èª¤è¨Šæ¯ */
        .error { color: #e74c3c; margin-top: 15px; font-size: 0.9rem; display: none; background: #fadbd8; padding: 10px; border-radius: 5px; }
        .hidden { display: none; }
        
        /* å„€è¡¨æ¿èˆ‡ä¸Šå‚³å€å¡Šæ¨£å¼ */
        .dashboard { width: 600px; text-align: left; }
        .admin-info { background: #ecf0f1; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        
        /* â˜…â˜…â˜… é€™æ˜¯æ–°åŠ çš„æ¨£å¼ï¼šä¸Šå‚³å€å¡Š â˜…â˜…â˜… */
        .upload-section { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid #eee; margin-top: 20px; }
        .upload-section h4 { margin-top: 0; color: #2980b9; border-left: 4px solid #2980b9; padding-left: 10px;}
    </style>
</head>
<body>

    <div id="loginSection" class="login-container">
        <h2>ğŸ”’ å¾Œå°ç®¡ç†ç³»çµ±</h2>
        <div class="input-group">
            <label>ç®¡ç†å“¡å¸³è™Ÿ</label>
            <input type="number" id="accountInput" placeholder="ä¾‹å¦‚: 1001">
        </div>
        <div class="input-group">
            <label>å¯†ç¢¼</label>
            <input type="password" id="passwordInput">
        </div>
        <button onclick="doLogin()">ç™»å…¥ç³»çµ±</button>
        <div id="errorMsg" class="error"></div>
    </div>

    <div id="dashboardSection" class="login-container dashboard hidden">
        <h2 style="color: #27ae60; border-color: #27ae60;">âœ… ç®¡ç†å“¡å„€è¡¨æ¿</h2>
        
        <div class="admin-info">
            <p><strong>ğŸ‘‹ æ­¡è¿å›ä¾†ï¼š</strong> <span id="adminNameDisplay" style="color: #2980b9;">--</span></p>
            <p><strong>ğŸ”° æ‚¨çš„æ¬Šé™ï¼š</strong> <span id="adminRoleDisplay">--</span></p>
        </div>

        <div class="upload-section">
            <h4>ğŸ“¸ ä¸Šå‚³æ”¹è£æ¡ˆä¾‹</h4>
            
            <div class="input-group">
                <label>ä½œå“æ¨™é¡Œ</label>
                <input type="text" id="pf_title" placeholder="ä¾‹å¦‚ï¼šæ¶ˆå…‰é»‘éœ¸æ°£æ”¹è£">
            </div>
            
            <div class="input-group">
                <label>åˆ†é¡ç­‰ç´š</label>
                <select id="pf_category">
                    <option value="dagai">å¤§æ”¹è»Šä¸» (5-10è¬)</option>
                    <option value="baogai">çˆ†æ”¹è»Šä¸» (10-30è¬)</option>
                    <option value="vvip">çˆ†æ”¹ VVIP (30-50è¬)</option>
                    <option value="svip">çˆ†æ”¹ SVIP (50è¬ä»¥ä¸Š)</option>
                </select>
            </div>

           <div class="mb-3">
                <label class="form-label">é¸æ“‡ç…§ç‰‡</label>
                <input type="file" id="fileInput" class="form-control" accept="image/*" required>
                <img id="imgPreview" src="" style="display:none; max-width: 300px; margin-top: 10px; border-radius: 5px;">

            <button type="submit" class="btn btn-primary w-100">ğŸ“¤ ä¸Šå‚³ä¸¦ç™¼å¸ƒ</button>

            <hr class="my-5">

            <h3 class="mb-3">ğŸ“ å·²ä¸Šå‚³çš„ä½œå“ç®¡ç†</h3>
            <div id="portfolioList" class="row">
                <div class="text-center text-muted">æ­£åœ¨è¼‰å…¥ä½œå“...</div>
            </div>

            <button type="button" onclick="uploadPortfolio()" style="background: #2980b9;">ğŸ“¤ ä¸Šå‚³ä¸¦ç™¼å¸ƒ</button>
        </div>
        <div style="margin-top: 30px; text-align: center;">
            <button onclick="logout()" style="background-color: #7f8c8d; width: auto; padding: 10px 30px;">ç™»å‡º</button>
        </div>
    </div>

    <script>
    const API_URL = "/portfolios"; 
    const API_LIST = "/admin/portfolio/list";
    const API_UPLOAD = "/admin/portfolio/upload";
    const API_DELETE = "/admin/portfolio"// ç¢ºä¿é€™æ˜¯ä½ å¾Œç«¯çš„ API è·¯å¾‘

    // --- 1. åœ–ç‰‡é è¦½åŠŸèƒ½ (é€™æ˜¯ä½ è¦çš„ï¼) ---
    const fileInput = document.getElementById('fileInput');
    const imgPreview = document.getElementById('imgPreview');

    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            // å»ºç«‹ä¸€å€‹æš«æ™‚çš„ç¶²å€ä¾†é¡¯ç¤ºåœ–ç‰‡
            const tempUrl = URL.createObjectURL(file);
            imgPreview.src = tempUrl;
            imgPreview.style.display = 'block'; // é¡¯ç¤ºåœ–ç‰‡
        } else {
            imgPreview.style.display = 'none';
        }
    });

    // --- 2. è¼‰å…¥ä¸¦é¡¯ç¤ºå·²ä¸Šå‚³çš„ä½œå“ ---
    async function loadPortfolios() {
        const listDiv = document.getElementById("portfolioList");
        try {
            const res = await fetch(API_LIST);
            const data = await res.json();
            
            listDiv.innerHTML = ""; // æ¸…ç©ºç›®å‰é¡¯ç¤ºçš„

            if (data.length === 0) {
                listDiv.innerHTML = '<p class="text-muted">ç›®å‰æ²’æœ‰ä»»ä½•ä½œå“ã€‚</p>';
                return;
            }

            // è·‘è¿´åœˆæŠŠæ¯å€‹ä½œå“ç•«å‡ºä¾†
            data.forEach(item => {
                const card = `
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div style="height: 200px; overflow: hidden;">
                                <img src="${item.image_url}" class="card-img-top" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">${item.title}</h5>
                                <p class="card-text text-muted small">${item.content || 'ç„¡æè¿°'}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <button onclick="deletePortfolio(${item.id})" class="btn btn-outline-danger btn-sm">ğŸ—‘ï¸ åˆªé™¤</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                listDiv.innerHTML += card;
            });

        } catch (error) {
            console.error("è¼‰å…¥å¤±æ•—:", error);
            listDiv.innerHTML = '<p class="text-danger">ç„¡æ³•è¼‰å…¥ä½œå“ï¼Œè«‹æª¢æŸ¥å¾Œç«¯é€£ç·šã€‚</p>';
        }
    }

    // --- 3. åˆªé™¤ä½œå“åŠŸèƒ½ ---
    async function deletePortfolio(id) {
        if (!confirm("ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™å€‹ä½œå“å—ï¼Ÿ")) return;

        try {
            const res = await fetch(`${API_DELETE}/${id}`, { method: 'DELETE' });
            if (res.ok) {
                alert("åˆªé™¤æˆåŠŸï¼");
                loadPortfolios(); // é‡æ–°æ•´ç†åˆ—è¡¨
            } else {
                alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            }
        } catch (error) {
            console.error("åˆªé™¤éŒ¯èª¤:", error);
        }
    }

    // --- 4. è¡¨å–®æäº¤ (ä¸Šå‚³) ---
    document.querySelector("form").addEventListener("submit", async (e) => {
        e.preventDefault();
        
        // æŠ“å–è¡¨å–®è³‡æ–™
        const title = document.querySelector('input[placeholder="ä¾‹å¦‚ï¼šæ¶ˆå…‰é»‘éœ¸æ°£æ”¹è£"]').value; // æŠ“æ¨™é¡Œ
        const category = document.querySelector('select').value; // æŠ“åˆ†é¡
        const file = fileInput.files[0];

        const formData = new FormData();
        formData.append("title", title);
        formData.append("content", category); // é€™è£¡æˆ‘æš«æ™‚æŠŠåˆ†é¡ç•¶ä½œ content å­˜ï¼Œçœ‹ä½ æƒ³å­˜å“ª
        formData.append("file", file);

        const btn = document.querySelector("button[type='submit']");
        btn.disabled = true;
        btn.textContent = "ä¸Šå‚³ä¸­...";

        try {
            const res = await fetch(API_UPLOAD, {
                method: "POST",
                body: formData
            });

            if (res.ok) {
                alert("âœ¨ ç™¼å¸ƒæˆåŠŸï¼");
                document.querySelector("form").reset(); // æ¸…ç©ºè¡¨å–®
                imgPreview.style.display = 'none'; // éš±è—é è¦½åœ–
                loadPortfolios(); // é‡æ–°æ•´ç†ä¸‹æ–¹åˆ—è¡¨
            } else {
                alert("ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥å¾Œå°æ—¥èªŒ");
            }
        } catch (err) {
            console.error(err);
            alert("ç™¼ç”ŸéŒ¯èª¤");
        } finally {
            btn.disabled = false;
            btn.textContent = "ğŸ“¤ ä¸Šå‚³ä¸¦ç™¼å¸ƒ";
        }
    });

    // ä¸€é€²ä¾†ç¶²é å°±å…ˆè¼‰å…¥åˆ—è¡¨
    loadPortfolios();
</script>
</body>
</html>