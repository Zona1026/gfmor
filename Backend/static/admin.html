<!DOCTYPE html>
<html lang="zh-TW" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GF Motor 內容管理</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background-color: var(--bs-dark-bg-subtle);
        }
        .preview-card {
            position: sticky;
            top: 1.5rem;
        }
        .preview-header {
            background-color: var(--bs-tertiary-bg);
            border-bottom: 0;
        }
        .preview-body {
            background-color: var(--bs-body-bg);
        }
        .preview-image-placeholder {
            min-height: 300px;
            background-color: var(--bs-secondary-bg);
        }
        #imgPreview {
            max-width: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="row g-4 justify-content-center">
        
        <!-- 左側：編輯區塊 -->
        <div class="col-lg-7">
            <div class="card border-secondary">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-pencil-square me-2"></i>建立作品集貼文</h5>
                </div>
                <div class="card-body">
                    <form id="uploadForm">
                        
                        <div class="mb-3">
                            <label for="postCategory" class="form-label">發佈到</label>
                            <select class="form-select" id="postCategory">
                                <option>GF Motor 作品集</option>
                            </select>
                        </div>

                        <div class="mb-3 p-3 border border-secondary-subtle rounded bg-dark-subtle">
                            <label for="uploadImage" class="form-label fw-bold">作品照片</label>
                            <p class="text-muted small">分享一張最能代表您作品的相片。</p>
                            <input type="file" class="form-control" id="uploadImage" accept="image/*" required>
                        </div>

                        <div class="mb-3">
                            <label for="postTitle" class="form-label fw-bold">標題</label>
                            <input type="text" class="form-control" id="postTitle" placeholder="例如：哈雷經典款全車改造" required>
                        </div>

                        <div class="mb-3">
                            <label for="postDescription" class="form-label fw-bold">內文</label>
                            <textarea class="form-control" id="postDescription" rows="5" placeholder="輸入關於此作品的詳細描述..."></textarea>
                        </div>

                        <div class="d-grid">
                            <button type="button" class="btn btn-primary btn-lg" onclick="uploadPost()">
                                <i class="bi bi-arrow-up-circle-fill me-2"></i>發佈作品
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 右側：預覽區塊 -->
        <div class="col-lg-5">
            <div class="card border-secondary preview-card">
                <div class="card-header preview-header text-muted small">
                    網站作品集預覽
                </div>
                <div class="card-body preview-body p-0">
                    <!-- 預覽圖片 -->
                    <div class="preview-image-placeholder d-flex align-items-center justify-content-center">
                        <img id="imgPreview" src="" class="d-none">
                        <span id="placeholderText" class="text-muted">尚未選擇圖片</span>
                    </div>

                    <!-- 預覽文字 -->
                    <div class="p-3">
                        <h5 id="previewTitle" class="card-title">(標題將顯示於此)</h5>
                        <p id="previewText" class="card-text text-body-secondary" style="white-space: pre-wrap;">(內文將顯示於此...)</p>
                    </div>

                    <div class="card-footer bg-transparent border-top-secondary d-flex justify-content-around text-muted small p-2">
                        <span><i class="bi bi-heart"></i> 讚</span>
                        <span><i class="bi bi-chat"></i> 留言</span>
                        <span><i class="bi bi-share"></i> 分享</span>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // --- 預覽功能完全保留，只更新對應的 ID ---

    // 1. 圖片預覽
    const uploadImageInput = document.getElementById('uploadImage');
    const imgPreview = document.getElementById('imgPreview');
    const placeholderText = document.getElementById('placeholderText');

    uploadImageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                imgPreview.src = event.target.result;
                imgPreview.classList.remove('d-none');
                placeholderText.classList.add('d-none');
            }
            reader.readAsDataURL(file);
        }
    });

    // 2. 標題即時同步
    const titleInput = document.getElementById('postTitle');
    const previewTitle = document.getElementById('previewTitle');
    titleInput.addEventListener('input', function() {
        previewTitle.innerText = this.value || "(標題將顯示於此)";
    });

    // 3. 內文即時同步
    const descInput = document.getElementById('postDescription');
    const previewText = document.getElementById('previewText');
    descInput.addEventListener('input', function() {
        previewText.innerText = this.value || "(內文將顯示於此...)";
    });

    // 4. 上傳函式 (尚未實作)
    function uploadPost() {
        const imageFile = uploadImageInput.files[0];
        const title = titleInput.value;
        const category = document.getElementById('postCategory').value; // 假設我們未來會用到
        const description = descInput.value;

        if (!imageFile || !title) {
            alert("請務必填寫標題並選擇一張圖片！");
            return;
        }

        // 這裡未來會接上後端的 /admin/portfolio/upload API
        alert(`準備發佈！\n標題: ${title}\n分類: ${category}\n描述: ${description.substring(0,20)}...`);

        // 以下是未來要使用的 FormData 準備
        const formData = new FormData();
        formData.append('title', title);
        formData.append('category', category);
        formData.append('description', description); // 假設 API 會接收
        formData.append('file', imageFile);

        /*
        // 未來的 API 呼叫
        fetch('/admin/portfolio/upload', {
            method: 'POST',
            body: formData
            // 注意：使用 FormData 時不要設定 Content-Type header，瀏覽器會自動處理
        })
        .then(response => response.json())
        .then(data => {
            if(data.message) {
                alert('上傳成功！');
                window.location.reload(); // 重新整理頁面
            } else {
                alert('上傳失敗：' + JSON.stringify(data));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('上傳時發生錯誤。');
        });
        */
    }
</script>
</body>
</html>