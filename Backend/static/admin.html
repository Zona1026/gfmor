<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GF Motor å¾Œå°ç®¡ç†ç³»çµ±</title>
    <style>
        /* é é¢åŸºç¤æ¨£å¼ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #2c3e50; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .login-container { background: white; padding: 2.5rem; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 400px; text-align: center; }
        
        h2 { color: #34495e; margin-bottom: 20px; border-bottom: 3px solid #e74c3c; display: inline-block; padding-bottom: 5px; }
        
        /* è¼¸å…¥æ¡†é€šç”¨æ¨£å¼ */
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; color: #666; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; transition: 0.3s; box-sizing: border-box; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        button { width: 100%; padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; transition: background 0.3s; }
        button:hover { background: #c0392b; }
        
        /* éŒ¯èª¤è¨Šæ¯ */
        .error { color: #e74c3c; margin-top: 15px; font-size: 0.9rem; display: none; background: #fadbd8; padding: 10px; border-radius: 5px; }
        .hidden { display: none; }
        
        /* å„€è¡¨æ¿èˆ‡ä¸Šå‚³å€å¡Šæ¨£å¼ */
        .dashboard { width: 600px; text-align: left; }
        .admin-info { background: #ecf0f1; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        
        /* â˜…â˜…â˜… é€™æ˜¯æ–°åŠ çš„æ¨£å¼ï¼šä¸Šå‚³å€å¡Š â˜…â˜…â˜… */
        .upload-section { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid #eee; margin-top: 20px; }
        .upload-section h4 { margin-top: 0; color: #2980b9; border-left: 4px solid #2980b9; padding-left: 10px;}
    </style>
</head>
<body>

    <div id="loginSection" class="login-container">
        <h2>ğŸ”’ å¾Œå°ç®¡ç†ç³»çµ±</h2>
        <div class="input-group">
            <label>ç®¡ç†å“¡å¸³è™Ÿ</label>
            <input type="number" id="accountInput" placeholder="ä¾‹å¦‚: 1001">
        </div>
        <div class="input-group">
            <label>å¯†ç¢¼</label>
            <input type="password" id="passwordInput">
        </div>
        <button onclick="doLogin()">ç™»å…¥ç³»çµ±</button>
        <div id="errorMsg" class="error"></div>
    </div>

    <div id="dashboardSection" class="login-container dashboard hidden">
        <h2 style="color: #27ae60; border-color: #27ae60;">âœ… ç®¡ç†å“¡å„€è¡¨æ¿</h2>
        
        <div class="admin-info">
            <p><strong>ğŸ‘‹ æ­¡è¿å›ä¾†ï¼š</strong> <span id="adminNameDisplay" style="color: #2980b9;">--</span></p>
            <p><strong>ğŸ”° æ‚¨çš„æ¬Šé™ï¼š</strong> <span id="adminRoleDisplay">--</span></p>
        </div>

        <div class="upload-section">
            <h4>ğŸ“¸ ä¸Šå‚³æ”¹è£æ¡ˆä¾‹</h4>
            
            <div class="input-group">
                <label>ä½œå“æ¨™é¡Œ</label>
                <input type="text" id="pf_title" placeholder="ä¾‹å¦‚ï¼šæ¶ˆå…‰é»‘éœ¸æ°£æ”¹è£">
            </div>
            
            <div class="input-group">
                <label>åˆ†é¡ç­‰ç´š</label>
                <select id="pf_category">
                    <option value="dagai">å¤§æ”¹è»Šä¸» (5-10è¬)</option>
                    <option value="baogai">çˆ†æ”¹è»Šä¸» (10-30è¬)</option>
                    <option value="vvip">çˆ†æ”¹ VVIP (30-50è¬)</option>
                    <option value="svip">çˆ†æ”¹ SVIP (50è¬ä»¥ä¸Š)</option>
                </select>
            </div>

            <div class="input-group">
                <label>é¸æ“‡ç…§ç‰‡</label>
                <input type="file" id="pf_file" accept="image/*">
            </div>

            <button type="button" onclick="uploadPortfolio()" style="background: #2980b9;">ğŸ“¤ ä¸Šå‚³ä¸¦ç™¼å¸ƒ</button>
        </div>
        <div style="margin-top: 30px; text-align: center;">
            <button onclick="logout()" style="background-color: #7f8c8d; width: auto; padding: 10px 30px;">ç™»å‡º</button>
        </div>
    </div>

    <script>
        // --- ç™»å…¥åŠŸèƒ½ (ä¿æŒä¸è®Š) ---
        async function doLogin() {
            const acc = document.getElementById("accountInput").value;
            const pwd = document.getElementById("passwordInput").value;
            const err = document.getElementById("errorMsg");
            err.style.display = "none";

            if (!acc || !pwd) { err.innerText = "è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼"; err.style.display="block"; return; }

            try {
                const res = await fetch("http://127.0.0.1:8000/admin/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ account: parseInt(acc), password: pwd })
                });
                const data = await res.json();

                if (res.ok) {
                    // åˆ‡æ›é¡¯ç¤º
                    document.getElementById("loginSection").classList.add("hidden");
                    document.getElementById("dashboardSection").classList.remove("hidden");
                    // å¡«å…¥è³‡æ–™
                    document.getElementById("adminNameDisplay").innerText = data.user.name;
                    document.getElementById("adminRoleDisplay").innerText = data.user.role;
                } else {
                    err.innerText = "ç™»å…¥å¤±æ•—ï¼š" + data.detail;
                    err.style.display = "block";
                }
            } catch (e) {
                console.error(e);
                err.innerText = "é€£ç·šéŒ¯èª¤";
                err.style.display = "block";
            }
        }

        function logout() { window.location.reload(); }

        // --- â˜…â˜…â˜… é€™æ˜¯æ–°åŠ çš„åŠŸèƒ½ï¼šä¸Šå‚³ä½œå“ â˜…â˜…â˜… ---
        async function uploadPortfolio() {
            // 1. æŠ“å–æ¬„ä½è³‡æ–™
            const title = document.getElementById("pf_title").value;
            const category = document.getElementById("pf_category").value;
            const fileInput = document.getElementById("pf_file");

            // 2. æª¢æŸ¥æœ‰æ²’æœ‰æ¼å¡«
            if(!title || !fileInput.files[0]) {
                alert("æ¨™é¡Œå’Œåœ–ç‰‡éƒ½è¦å¡«å–”ï¼");
                return;
            }

            // 3. æ‰“åŒ…è³‡æ–™ (å› ç‚ºæœ‰åœ–ç‰‡ï¼Œè¦ç”¨ FormData)
            const formData = new FormData();
            formData.append("title", title);
            formData.append("category", category);
            formData.append("file", fileInput.files[0]);

            try {
                // 4. é€çµ¦å¾Œç«¯
                const res = await fetch("http://127.0.0.1:8000/admin/portfolio/upload", {
                    method: "POST",
                    body: formData // ç€è¦½å™¨æœƒè‡ªå·±è™•ç† Content-Type
                });

                if (res.ok) {
                    alert("âœ… ä¸Šå‚³æˆåŠŸï¼");
                    // æ¸…ç©ºæ¬„ä½æ–¹ä¾¿ä¸‹ä¸€ç­†
                    document.getElementById("pf_title").value = "";
                    fileInput.value = "";
                } else {
                    alert("âŒ ä¸Šå‚³å¤±æ•—");
                }
            } catch(e) {
                alert("é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¢ºèªå¾Œç«¯æœ‰é–‹å•Ÿ");
            }
        }
    </script>
</body>
</html>